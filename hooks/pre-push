#!/bin/bash

# Git pre-push hook for quality guardrails
# This hook runs before pushing to remote and aborts if any check fails

set -e  # Exit on any error

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Function to print colored output
print_status() {
    echo -e "${2}${1}${NC}"
}

# Function to run a command and handle errors
run_check() {
    local check_name="$1"
    local command="$2"

    print_status "Run $check_name...\n" "$YELLOW"

    if eval "$command"; then
        print_status "‚úÖ All $check_name passed\n" "$GREEN"
    else
        print_status "‚ùå $check_name failed\n" "$RED"
        print_status "Push aborted. Please fix the issues and try again." "$RED"
        exit 1
    fi
}

print_status "üîç Running quality checks before pushing...\n" "$YELLOW"

# Run cargo test
run_check "tests" "cargo test"

# Run cargo clippy
run_check "clippy lints" "cargo clippy -- -D warnings"

# Run cargo fmt --check
run_check "code formatting checks" "cargo fmt -- --check"

print_status "‚úÖ All quality checks were successful! Pushing changes...\n" "$GREEN"
